!function(t){function i(i,o){this.el=t(i),this.options=o||{},this.options.cache={isMovingUp:!1,scrollPosition:0,diff:0},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,this.autoHide=!1!==this.options.autoHide,this.marginTop=void 0===this.options.marginTop?2:this.options.marginTop,this.padding=void 0===this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),o.debug&&(console.group("Antiscroll"),console.log("Inner element:",this.inner.get(0)),console.log("Content width:",this.inner.css("width")),console.log("Content height:",this.inner.css("height"))),this.inner.css({width:"+="+(this.y?s():0),height:"+="+(this.x?s():0)}),o.debug&&(console.log("New content width:",this.inner.css("width")),console.log("New content height:",this.inner.css("height")),console.groupEnd()),this.refresh()}function o(i){this.pane=i,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(t.proxy(this,"mouseenter")),this.pane.el.mouseleave(t.proxy(this,"mouseleave")),this.el.mousedown(t.proxy(this,"mousedown")),this.innerPaneScrollListener=t.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=t.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var o=this.pane.options.initialDisplay;o!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),parseInt(o,10)||3e3)))}function e(t,i){function o(){}o.prototype=i.prototype,t.prototype=new o}function s(){if(void 0===n){var i=t('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/></div>');t("body").append(i);var o=t(i).innerWidth(),e=t("div",i).innerWidth();t(i).remove(),n=o-e}return n}t.fn.antiscroll=function(i){return this.each(function(){var o=this,e=t(o);i.onlyOnWindows&&"Win"!==navigator.platform.substr(0,3)||i.notOnWindows&&"Win"===navigator.platform.substr(0,3)||(i.autoWrap&&(e.parent().addClass("antiscroll-wrap"),e.addClass("antiscroll-inner"),e=e.parent(),o=e.get()),e.data("antiscroll")&&e.data("antiscroll").destroy(),i.debug&&(console.group("$.fn.antiscroll"),console.log("Wrapper element:",e.get(0)),console.log("Options:",i),console.groupEnd()),e.data("antiscroll",new t.Antiscroll(o,i)))})},t.Antiscroll=i,i.prototype.refresh=function(){this.options.debug&&console.group("Antiscroll.refresh");var t=this.inner.get(0).scrollWidth>this.el.width()+(this.y?s():0),i=this.inner.get(0).scrollHeight>this.el.height()+(this.x?s():0);return this.options.debug&&(console.log("Needs horizontal scroll:",t),console.log("Needs vertical scroll:",i)),this.x&&(!this.horizontal&&t?this.horizontal=new o.Horizontal(this):this.horizontal&&!t?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&i?this.vertical=new o.Vertical(this):this.vertical&&!i?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update()),this.options.debug&&console.groupEnd(),"Scrollbars have been refreshed."},i.prototype.destroy=function(){return this.options.debug&&console.group("Antiscroll.destroy"),this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this.options.debug&&console.groupEnd(),this},i.prototype.rebuild=function(o){this.options.debug&&console.group("Antiscroll.rebuild");var e=t.extend({},this.options,o);return e.debug&&console.log("Options:",e),this.destroy(),this.inner.attr("style",""),i.call(this,this.el,e),this.options.debug&&console.groupEnd(),this},o.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},o.prototype.mouseenter=function(){this.enter=!0,this.show()},o.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},o.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),1500))),this.update()},o.prototype.mousedown=function(i){i.preventDefault(),this.dragging=!0,this.startPageY=i.pageY-parseInt(this.el.css("top"),10),this.startPageX=i.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};var o=t.proxy(this,"mousemove"),e=this,s=function(){e.dragging=!1,this.onselectstart=null,t(this).unbind("mousemove",o),e.enter||e.hide()};t(this.el[0].ownerDocument).mousemove(o).mouseup(s)},o.prototype.show=function(){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},o.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},o.Horizontal=function(i){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal"/>',i.el),o.call(this,i)},e(o.Horizontal,o),o.Horizontal.prototype.update=function(){var t=this.pane.el.width(),i=t-2*this.pane.padding,o=this.pane.inner.get(0);return this.el.css({width:i*t/o.scrollWidth,left:i*o.scrollLeft/o.scrollWidth}),t<o.scrollWidth},o.Horizontal.prototype.mousemove=function(t){var i=this.pane.el.width()-2*this.pane.padding,o=t.pageX-this.startPageX,e=this.el.width(),s=this.pane.inner.get(0),n=Math.min(Math.max(o,0),i-e);s.scrollLeft=(s.scrollWidth-this.pane.el.width())*n/(i-e)},o.Horizontal.prototype.mousewheel=function(t,i){return 0>i&&0===this.pane.inner.get(0).scrollLeft||i>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())===this.innerEl.scrollWidth?(t.preventDefault(),!1):void 0},o.Vertical=function(i){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical" style="margin-top: '+i.marginTop+'px;" />',i.el),o.call(this,i)},e(o.Vertical,o),o.Vertical.prototype.update=function(){this.pane.options.debug&&(console.group("Scrollbar.Vertical"),console.log("Padding: "+this.pane.padding));var t=this.pane.el.height(),i=t-2*this.pane.padding,o=this.innerEl,e=i*t/o.scrollHeight;e=20>e?20:e,this.pane.options.debug&&(console.log("Pane height: "+t),console.log("Track height: "+i),console.log("Scrollbar height: "+e),console.log("Scrollable height: "+o.scrollHeight));var s=i*o.scrollTop/o.scrollHeight;if(s+e>i){this.pane.options.debug&&console.warn("Scrollbar goes beyond boundaries. Offset will be adjusted.");var n=s+e-i;s-=n}if(this.pane.options.startBottom){var l=t-e,r=o.scrollHeight-l;this.pane.options.debug&&(console.log("Pane height - scrollbar:",l),console.log("Scroll height before bottom: "+parseInt(o.scrollHeight,10)+" - "+parseInt(l,10)+" = "+parseInt(r,10),r)),r>0&&(s=l,o.scrollTop=r,this.pane.options.startBottom=void 0)}return this.pane.options.debug&&(console.log("Last position: "+this.pane.options.cache.scrollPosition),console.log("Moving to: "+s+" (topPos), "+o.scrollTop+" (scrollTop)"),this.pane.options.cache.diff=s-this.pane.options.cache.scrollPosition,console.log("Step difference: "+this.pane.options.cache.diff),console.groupEnd()),this.el.css({height:e,top:s}),this.pane.options.cache.scrollPosition=s,t<o.scrollHeight},o.Vertical.prototype.mousemove=function(t){var i=this.pane.el.height(),o=i-2*this.pane.padding,e=t.pageY-this.startPageY,s=this.el.height(),n=this.innerEl,l=Math.min(Math.max(e,0),o-s);n.scrollTop=(n.scrollHeight-i)*l/(o-s)},o.Vertical.prototype.mousewheel=function(t,i){function o(t,o,e){return i>0&&0===e||0>i&&e+Math.ceil(t)===o?!0:!1}return this.pane.options.debug&&(console.group("Scrollbar.Vertical.mousewheel"),console.log("Mousewheel event",t)),this.pane.options.cache.isMovingUp=t.deltaY<0?!1:!0,this.pane.options.debug&&(console.log("Moves up: "+this.pane.options.cache.isMovingUp),console.groupEnd()),o(this.pane.el.height(),this.innerEl.scrollHeight,this.innerEl.scrollTop)?(t.preventDefault(),!1):void 0};var n}(jQuery);