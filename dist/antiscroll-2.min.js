!function(t){function i(i,e){this.el=t(i),this.options=e||{},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,this.autoHide=!1!==this.options.autoHide,this.marginTop=void 0===this.options.marginTop?2:this.options.marginTop,this.padding=void 0===this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),e.debug&&(console.group("Antiscroll"),console.log("Inner element:",this.inner.get(0)),console.log("Content width:",this.inner.css("width")),console.log("Content height:",this.inner.css("height"))),this.inner.css({width:"+="+(this.y?s():0),height:"+="+(this.x?s():0)}),e.debug&&(console.log("New content width:",this.inner.css("width")),console.log("New content height:",this.inner.css("height")),console.groupEnd()),this.refresh()}function e(i){this.pane=i,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(t.proxy(this,"mouseenter")),this.pane.el.mouseleave(t.proxy(this,"mouseleave")),this.el.mousedown(t.proxy(this,"mousedown")),this.innerPaneScrollListener=t.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=t.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var e=this.pane.options.initialDisplay;e!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),parseInt(e,10)||3e3)))}function o(t,i){function e(){}e.prototype=i.prototype,t.prototype=new e}function s(){if(void 0===n){var i=t('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/></div>');t("body").append(i);var e=t(i).innerWidth(),o=t("div",i).innerWidth();t(i).remove(),n=e-o}return n}t.fn.antiscroll=function(i){return this.each(function(){var e=this,o=t(e);i.onlyOnWindows&&"Win"!==navigator.platform.substr(0,3)||i.notOnWindows&&"Win"===navigator.platform.substr(0,3)||(i.autoWrap&&(o.parent().addClass("antiscroll-wrap"),o.addClass("antiscroll-inner"),o=o.parent(),e=o.get()),o.data("antiscroll")&&o.data("antiscroll").destroy(),i.debug&&(console.group("$.fn.antiscroll"),console.log("Wrapper element:",o.get(0)),console.log("Options:",i),console.groupEnd()),o.data("antiscroll",new t.Antiscroll(e,i)))})},t.Antiscroll=i,i.prototype.refresh=function(){this.options.debug&&console.group("Antiscroll.refresh");var t=this.inner.get(0).scrollWidth>this.el.width()+(this.y?s():0),i=this.inner.get(0).scrollHeight>this.el.height()+(this.x?s():0);return this.options.debug&&(console.log("Needs horizontal scroll:",t),console.log("Needs vertical scroll:",i)),this.x&&(!this.horizontal&&t?this.horizontal=new e.Horizontal(this):this.horizontal&&!t?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&i?this.vertical=new e.Vertical(this):this.vertical&&!i?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update()),this.options.debug&&console.groupEnd(),"Scrollbars have been refreshed."},i.prototype.destroy=function(){return this.options.debug&&console.group("Antiscroll.destroy"),this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this.options.debug&&console.groupEnd(),this},i.prototype.rebuild=function(e){this.options.debug&&console.group("Antiscroll.rebuild");var o=t.extend({},this.options,e);return o.debug&&console.log("Options:",o),this.destroy(),this.inner.attr("style",""),i.call(this,this.el,o),this.options.debug&&console.groupEnd(),this},e.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},e.prototype.mouseenter=function(){this.enter=!0,this.show()},e.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},e.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),1500))),this.update()},e.prototype.mousedown=function(i){i.preventDefault(),this.dragging=!0,this.startPageY=i.pageY-parseInt(this.el.css("top"),10),this.startPageX=i.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};var e=t.proxy(this,"mousemove"),o=this,s=function(){o.dragging=!1,this.onselectstart=null,t(this).unbind("mousemove",e),o.enter||o.hide()};t(this.el[0].ownerDocument).mousemove(e).mouseup(s)},e.prototype.show=function(){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},e.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},e.Horizontal=function(i){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal"/>',i.el),e.call(this,i)},o(e.Horizontal,e),e.Horizontal.prototype.update=function(){var t=this.pane.el.width(),i=t-2*this.pane.padding,e=this.pane.inner.get(0);return this.el.css({width:i*t/e.scrollWidth,left:i*e.scrollLeft/e.scrollWidth}),t<e.scrollWidth},e.Horizontal.prototype.mousemove=function(t){var i=this.pane.el.width()-2*this.pane.padding,e=t.pageX-this.startPageX,o=this.el.width(),s=this.pane.inner.get(0),n=Math.min(Math.max(e,0),i-o);s.scrollLeft=(s.scrollWidth-this.pane.el.width())*n/(i-o)},e.Horizontal.prototype.mousewheel=function(t,i){return 0>i&&0===this.pane.inner.get(0).scrollLeft||i>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())===this.innerEl.scrollWidth?(t.preventDefault(),!1):void 0},e.Vertical=function(i){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical" style="margin-top: '+i.marginTop+'px;" />',i.el),e.call(this,i)},o(e.Vertical,e),e.Vertical.prototype.update=function(){this.pane.options.debug&&(console.group("Scrollbar.Vertical"),console.log("Padding: "+this.pane.padding));var t=this.pane.el.height(),i=t-2*this.pane.padding,e=this.innerEl,o=i*t/e.scrollHeight;o=20>o?20:o,this.pane.options.debug&&(console.log("Pane height: "+t),console.log("Track height: "+i),console.log("Scrollbar height: "+o),console.log("Scrollable height: "+e.scrollHeight));var s=i*e.scrollTop/e.scrollHeight;if(s+o>i){var n=s+o-i;s=s-n-3}if(this.pane.options.startBottom){var l=t-o,r=e.scrollHeight-l;this.pane.options.debug&&(console.log("Pane height - scrollbar:",l),console.log("Scroll height before bottom: "+parseInt(e.scrollHeight,10)+" - "+parseInt(l,10)+" = "+parseInt(r,10),r)),r>0&&(s=l,e.scrollTop=r,this.pane.options.startBottom=void 0)}return this.pane.options.debug&&(console.log("Moving to: "+s+" (topPos), "+e.scrollTop+" (scrollTop)"),console.groupEnd()),this.el.css({height:o,top:s}),t<e.scrollHeight},e.Vertical.prototype.mousemove=function(t){var i=this.pane.el.height(),e=i-2*this.pane.padding,o=t.pageY-this.startPageY,s=this.el.height(),n=this.innerEl,l=Math.min(Math.max(o,0),e-s);n.scrollTop=(n.scrollHeight-i)*l/(e-s)},e.Vertical.prototype.mousewheel=function(t,i){return i>0&&0===this.innerEl.scrollTop||0>i&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())===this.innerEl.scrollHeight?(t.preventDefault(),!1):void 0};var n}(jQuery);