!function(t){function o(){}function e(t,e){e.debug&&console.warn("Scrollbars are not applied. A mock will be used to fake the public API."),t.parent().data("antiscroll",new o)}function i(o,e){this.el=t(o),this.options=e||{},this.options.cache={isMovingUp:!1,scrollPosition:0,diff:0},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,this.autoHide=!1!==this.options.autoHide,this.marginTop=void 0===this.options.marginTop?2:this.options.marginTop,this.padding=void 0===this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),e.debug&&(console.group("Antiscroll"),console.log("Inner element:",this.inner.get(0)),console.log("Content width:",this.inner.css("width")),console.log("Content height:",this.inner.css("height"))),this.inner.css({width:"+="+(this.y?l():0),height:"+="+(this.x?l():0)}),e.debug&&(console.log("New content width:",this.inner.css("width")),console.log("New content height:",this.inner.css("height")),console.groupEnd()),this.refresh()}function n(o){this.pane=o,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(t.proxy(this,"mouseenter")),this.pane.el.mouseleave(t.proxy(this,"mouseleave")),this.el.mousedown(t.proxy(this,"mousedown")),this.innerPaneScrollListener=t.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=t.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var e=this.pane.options.initialDisplay;e!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),parseInt(e,10)||3e3)))}function s(t,o){function e(){}e.prototype=o.prototype,t.prototype=new e}function l(){if(void 0===r){var o=t('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/></div>');t("body").append(o);var e=t(o).innerWidth(),i=t("div",o).innerWidth();t(o).remove(),r=e-i}return r}o.prototype.destroy=function(){},o.prototype.rebuild=function(){},o.prototype.refresh=function(){},t.fn.antiscroll=function(o){return this.each(function(){var i=this,n=t(i);return o.onlyOnWindows&&"Win"!==navigator.platform.substr(0,3)?void e(n,o):o.notOnWindows&&"Win"===navigator.platform.substr(0,3)?void e(n,o):o.notOnMacintosh&&"Mac"===navigator.platform.substr(0,3)?void e(n,o):(o.autoWrap&&(n.parent().addClass("antiscroll-wrap"),n.addClass("antiscroll-inner"),n=n.parent(),i=n.get()),n.data("antiscroll")&&n.data("antiscroll").destroy(),o.debug&&(console.group("$.fn.antiscroll"),console.log("Wrapper element:",n.get(0)),console.log("Options:",o),console.groupEnd()),o.autoResize&&t(window).resize(function(){t(i).data("antiscroll").rebuild()}),void n.data("antiscroll",new t.Antiscroll(i,o)))})},t.Antiscroll=i,i.prototype.refresh=function(){this.options.debug&&console.group("Antiscroll.refresh");var t=this.inner.get(0).scrollWidth>this.el.width()+(this.y?l():0),o=this.inner.get(0).scrollHeight>this.el.height()+(this.x?l():0);return this.options.debug&&(console.log("Needs horizontal scroll:",t),console.log("Needs vertical scroll:",o)),this.x&&(!this.horizontal&&t?this.horizontal=new n.Horizontal(this):this.horizontal&&!t?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&o?this.vertical=new n.Vertical(this):this.vertical&&!o?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update()),this.options.debug&&console.groupEnd(),"Scrollbars have been refreshed."},i.prototype.destroy=function(){return this.options.debug&&console.group("Antiscroll.destroy"),this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this.options.debug&&console.groupEnd(),this},i.prototype.rebuild=function(o){this.options.debug&&console.group("Antiscroll.rebuild");var e=t.extend({},this.options,o);return e.debug&&console.log("Options:",e),this.destroy(),this.inner.attr("style",""),i.call(this,this.el,e),this.options.debug&&console.groupEnd(),this},n.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},n.prototype.mouseenter=function(){this.enter=!0,this.show()},n.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},n.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(t.proxy(this,"hide"),1500))),this.update()},n.prototype.mousedown=function(o){o.preventDefault(),this.dragging=!0,this.startPageY=o.pageY-parseInt(this.el.css("top"),10),this.startPageX=o.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};var e=t.proxy(this,"mousemove"),i=this,n=function(){i.dragging=!1,this.onselectstart=null,t(this).unbind("mousemove",e),i.enter||i.hide()};t(this.el[0].ownerDocument).mousemove(e).mouseup(n)},n.prototype.show=function(){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},n.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},n.Horizontal=function(o){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal"/>',o.el),n.call(this,o)},s(n.Horizontal,n),n.Horizontal.prototype.update=function(){var t=this.pane.el.width(),o=t-2*this.pane.padding,e=this.pane.inner.get(0);return this.el.css({width:o*t/e.scrollWidth,left:o*e.scrollLeft/e.scrollWidth}),t<e.scrollWidth},n.Horizontal.prototype.mousemove=function(t){var o=this.pane.el.width()-2*this.pane.padding,e=t.pageX-this.startPageX,i=this.el.width(),n=this.pane.inner.get(0),s=Math.min(Math.max(e,0),o-i);n.scrollLeft=(n.scrollWidth-this.pane.el.width())*s/(o-i)},n.Horizontal.prototype.mousewheel=function(t,o){return 0>o&&0===this.pane.inner.get(0).scrollLeft||o>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())===this.innerEl.scrollWidth?(t.preventDefault(),!1):void 0},n.Vertical=function(o){this.el=t('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical" style="margin-top: '+o.marginTop+'px;" />',o.el),n.call(this,o)},s(n.Vertical,n),n.Vertical.prototype.update=function(){this.pane.options.debug&&console.group("Scrollbar.Vertical.update");var t=this.pane.el.height(),o=t-2*this.pane.padding,e=this.innerEl,i=o*t/e.scrollHeight;i=20>i?20:i,i=parseInt(i,10),this.pane.options.debug&&(console.groupCollapsed("Measurements"),console.log("Content height: ",e.scrollHeight),console.log("Container height:",t),console.log("Track height:",o),console.log("Scrollbar height:",i),console.log("Scrollable track:",o-i),console.groupEnd());var n=o*e.scrollTop/e.scrollHeight;if(n+i>o){this.pane.options.debug&&console.warn("Scrollbar goes beyond boundaries. Offset will be adjusted.");var s=n+i-o;n-=s}if(this.pane.options.startBottom){var l=t-i,r=e.scrollHeight-l;this.pane.options.debug&&(console.log("Pane height - scrollbar:",l),console.log("Scroll height before bottom: "+parseInt(e.scrollHeight,10)+" - "+parseInt(l,10)+" = "+parseInt(r,10),r)),r>0&&(n=l,e.scrollTop=r,this.pane.options.startBottom=void 0)}return n=Math.round(n),this.pane.options.debug&&(console.log("Scrolled track: "+n+" / "+o),console.log("Scrolled content: "+e.scrollTop+" / "+e.scrollHeight),this.pane.options.cache.diff=n-this.pane.options.cache.scrollPosition,console.groupEnd()),this.el.css({height:i,top:n}),this.pane.options.cache.scrollPosition=n,t<e.scrollHeight},n.Vertical.prototype.mousemove=function(t){this.pane.options.debug&&console.group("Scrollbar.Vertical.mousemove");var o=this.pane.el.height(),e=o-2*this.pane.padding,i=this.innerEl,n=t.pageY-this.startPageY,s=this.el.height(),l=e-s,r=Math.min(Math.max(n,0),l);this.pane.options.debug&&(console.groupCollapsed("Measurements"),console.log("Content height: ",i.scrollHeight),console.log("Container height:",o),console.log("Track height:",e),console.log("Scrollbar height:",s),console.log("Scrollable track:",e-s),console.groupEnd(),console.log("Scrolled track: "+r+" / "+e));var h=(i.scrollHeight-e)*r/l;h=Math.round(h),this.pane.options.debug&&console.log("Scrolled content: "+h+" = ("+i.scrollHeight+" - "+o+") * "+r+" / "+l),i.scrollTop=h,this.pane.options.debug&&console.groupEnd()},n.Vertical.prototype.mousewheel=function(t,o){function e(t,e,i){return o>0&&0===i||0>o&&i+Math.ceil(t)===e?!0:!1}if(this.pane.options.debug&&(console.group("Scrollbar.Vertical.mousewheel"),console.log("Mousewheel event",t)),this.pane.options.cache.isMovingUp=t.deltaY<0?!1:!0,this.pane.options.debug){console.log("Moves up: "+this.pane.options.cache.isMovingUp);var i=-1*t.deltaY*t.deltaFactor;console.log("Delta factor: "+i);var n=this.innerEl.scrollTop+i;console.log("Scrolled content: "+n),console.groupEnd()}return e(this.pane.el.height(),this.innerEl.scrollHeight,this.innerEl.scrollTop)?(t.preventDefault(),!1):void 0};var r}(jQuery);